# tetris

주제: 일대일 온라인 테트리스 게임

제작 동기:
이번 학기 수업의 목표는, 머신러닝으로 나아가는 교두보로서 파이썬이란 언어에 친숙해지는 것이라고 생각합니다. 저는 간단한 게임을 제작하여 이 목표를 달성하고자 했습니다. 게임을 프로젝트 주제로 선정한 이유는 어느 한 부분에만 치우치지 않은 다양한 문법을 연습하기 위함입니다. 그 중에서도 테트리스 게임을 고른 이유는 구현이 복잡하지 않고 매트릭스를 주로 다루기 때문입니다.

테트리스는 Tetromino라 불리는 블럭 배열과, 그 블럭이 놓인 배열이 동적으로 상호작용하는 게임입니다. 따라서 이번 학기에 배운 numpy 모듈을 활용할 여지가 많을 것이라 생각했습니다. 또한 온라인 기능을 구현하여 웹과 비동기 프로그래밍에 대한 기초를 습득하고 싶었습니다.

제작 과정과 코드 설명:
우선 테트리스 게임의 기본적인 동작 원리를 알 필요가 있었습니다.
따라서 먼저 로컬에서 실행되는 터미널 게임을 제작하였습니다.

레포지토리의 game 폴더를 다운받고,

```
$ python game
```

위 명령어를 실행하면 cmd에서 테트리스 게임이 실행됩니다.

주의: 윈도우에서는 실행되지만, 리눅스나 맥os와는 호환이 되지 않을 수 있습니다.


![cmdtetris](img/cmdtetris.webp)

파일의 구조는 다음과 같습니다.

```python
class Block:
    ...
class Board:
    ...
class Game:
    ...
    async def start(self):
        ...
    def display(self):
        ...
    async def handle_keyboard_events(self):
        ...
    # 기타 조작을 위한 메소드들
```

Block 클래스는 움직이는 블럭,
Board 클래스는 블럭이 놓인 판,
Game 클래스는 게임의 기능적인 부분을 담당합니다.

여기서 핵심이 되는 것은 async 메소드인
start와 handle_keyboard_events 함수입니다.

파이썬의 스크립트는 기본적으로 동기적으로 실행되기 때문에, 블럭이 일정 주기로 떨어지는 동작과 사용자의 키보드 입력에 따른 동작을 따로따로 구현하기가 어렵습니다.

async 함수는 코드를 비동기적으로 실행하여 이 문제를 해결해줍니다. 다시말해, 블럭이 일정 주기로 떨어지는 동안에도 동시에 키보드 입력을 처리할 수 있게 해줍니다.

한편 위 함수들은 display 함수와 더불어 온라인 테트리스에서는 그대로 사용할 수 없는 코드입니다.

따라서 온라인 버전의 테트리스에서는 Game 클래스를 다음과 같은 객체로 상속하였습니다.

```python
...
class WebGame(Game):
    async def display(self):
        ...
    async def start(self):
        ...
```

display 메소드와 start 메소드는 웹서버 환경에 맞추어 오버라이딩 하였습니다.

handle_keyboard_events 함수는 서버에서 구현하지 않고,
클라이언트측 javascript로 구현하였습니다. 게임을 하는 주체는 서버 운영자(파이썬 파일 실행한 사람)가 아니라 서버에 접속한 유저이기 때문입니다.

프론트엔드 코드는 최대한 단순하게 작성하였습니다.

